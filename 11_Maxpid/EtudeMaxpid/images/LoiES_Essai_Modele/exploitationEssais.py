import matplotlib.pyplot as plt
import numpy as np
from math import pi,sqrt


#essai1 = "Essai_01/0_90.Txt"
essai2 = "Essai_02/0_90.Txt"
modele1 = ""

fid = open(essai2,"r")
fid.readline()
fid.readline()
fichier = []
for ligne in fid :
    ligne = ligne.replace("        "," ")
    ligne = ligne.replace("       "," ")
    ligne = ligne.replace("      "," ")
    ligne = ligne.replace("     "," ")
    ligne = ligne.replace("    "," ")
    ligne = ligne.replace("   "," ")
    ligne = ligne.replace("  "," ")
    ligne = ligne.replace("\n","")
    ligne = ligne.split(" ")
    if len(ligne)>1:
        for i in range (len(ligne)-1,-1,-1):
            if ligne[i] == "":
                del ligne[0]
            else : 
                ligne[i] = float(ligne[i])
        fichier.append(ligne)

fid.close()

temps =[] # temps en ms dans le fichier, indice 0
pos_bras=[] # position du bras en degrés, indice 2
tx_bras=[] # taux de rotation du bras en rad/s, indice 5
tx_mot=[] # taux de rotation du moteur en rad/s, indice 6
gamma = []
for ligne in fichier:
    temps.append(ligne[0]/1000.)
    pos_bras.append(ligne[2]*180/pi)
    tx_bras.append(ligne[5])
    tx_mot.append(ligne[6])
    
gamma=[0]
for i in range(len(tx_mot)-1):
    deltaT = (temps[i+1]-temps[i])
    gammatmp = gamma[i]+deltaT*tx_mot[i]
    gamma.append(gammatmp)



gamma = np.array(gamma)
dgamma = np.array(tx_mot)

## Loi Entrée Sortie Théorique
a,b,c,d = 106.3, 59, 70, 80
p = 4
lambda0 = sqrt(d*d+(b+c)**2)

tps = np.linspace(0,4,1000)
dgam = np.ones(1000)*40 # 40 rad/s
gam = 40*tps

gamma = gam
dgamma = dgam

dtheta = - ((lambda0-p*gamma/(2*pi))*((-p*dgamma)/(2*pi))/(a*b)) / ( np.sqrt(1- (((lambda0-(p*gamma)/(2*pi))**2-a*a-b*b)/(2*a*b))**2))


theta = np.arccos((((lambda0-p*gamma/(2*pi))**2)-a*a-b*b)/(2*a*b))-np.arctan(d/c)
theta = theta*360/(2*pi)


"""
for i in range(len(gamma)):
    gam = gamma[i]
    dgam = tx_bras[i]
    pp = -(((np.sqrt(d*d+c*c+b*b+2*b*c)-p*gamma/(2*pi))*(-p*dgamma/(2*pi)))/(a*b))/(np.sqrt(1-((((np.sqrt(d*d+c*c+b*b+2*b*c)-p*gamma/(2*pi))**2)-a*a-b*b)/(2*a*b))**2))
    print(
"""
    





#plt.plot(temps,tx_mot,label = "Moteur")
#plt.plot(temps,tx_bras,label = "Bras")
plt.plot(tps,theta,label = "Vitesse bras simulee")

plt.legend()
plt.show()